<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Clouds, Virtualization and something more..."><meta name=Author content="Volodymyr Vrublevskyy"><meta name=keywords content="IT Talks"><link rel=stylesheet href=https://vovando.dev/css/syntax.css><link rel=stylesheet href=https://vovando.dev/css/style.css><script src=https://kit.fontawesome.com/1b7478c139.js crossorigin=anonymous></script><title>IT Talks</title></head><body><aside id=sidenav><header><a href=https://vovando.dev/><img src=https://vovando.dev/avatar.png alt=avatar></a>
<a id=branding href=https://vovando.dev/>IT Talks</a></header><nav><a href=/><i class="fas fa-home fa-sm"></i><span>whoami</span></a>
<a href=/posts><i class="fas fa-keyboard fa-ms"></i><span>blog</span></a>
<a href=/tags><i class="fas fa-tags fa-ms"></i><span>tags</span></a>
<a href=https://github.com/vovandodev target=_blank><i class="fab fa-github fa-ms"></i><span>github</span></a>
<a href=/index.xml><i class="fas fa-rss fa-ms"></i><span>RSS</span></a>
<a href=/contact><i class="far fa-envelope"></i><span>contact</span></a></nav></aside><main id=main><a href=javascript:void(0) id=closebtn onclick=navToggle()><i class="fas fa-bars fa-lg"></i></a><div class=content><h1 id=title>Private Maven Repository in Amazon S3</h1><nav id=TableOfContents><ul><li><a href=#create-an-s3-bucket><strong>Create an S3 Bucket</strong></a></li><li><a href=#create-an-iam-user><strong>Create an IAM User</strong></a></li><li><a href=#configure-maven-settingsxml><strong>Configure maven</strong> settings.xml</a></li></ul></nav><p>Â A few days ago I had an interesting task with Maven and AWS S3. We decided to use S3 bucket as a private Maven repository. <a href=https://aws.amazon.com/s3/>Amazon S3</a>Â is a good place for keeping privateÂ <a href=https://noteits.net/2016/12/16/how-to-install-maven-on-centos/>Maven</a>Â artifacts.</p><p>If you want to use S3 bucket as a private or public maven repo, first of all, you need to create an s3 bucket, create IAM user and configure AWS access by keys. It&rsquo;s a very simple task, let&rsquo;s do it.</p><h2 id=create-an-s3-bucket><strong>Create an S3 Bucket</strong></h2><p>{#create-an-s3-bucket}</p><ol><li>Create a new S3 bucket. Name it using your project domain and a prefix. For example, repo.myproject.io, repo is a prefix and myproject.io is the domain.</li></ol><p>There&rsquo;s no need to configure any permissions for this bucket. Just create it through theÂ <a href=https://console.aws.amazon.com/console/home>Amazon S3 console</a>.</p><h2 id=create-an-iam-user><strong>Create an IAM User</strong></h2><p>{#create-an-iam-user}</p><p>Create a new IAM user.Name it like project-maven if your project name is project ðŸ˜€</p><p>Add a new &ldquo;inline policy&rdquo; to the user:</p><p><em>{<br>Â Â &ldquo;Statement&rdquo;: [<br>Â Â Â Â {<br>Â Â Â Â Â Â &ldquo;Effect&rdquo;: &ldquo;Allow&rdquo;,<br>Â Â Â Â Â Â &ldquo;Action&rdquo;: &ldquo;s3:<em>&rdquo;,<br>Â Â Â Â Â Â &ldquo;Resource&rdquo;: [<br>Â Â Â Â Â Â Â Â &ldquo;arn:aws:s3:::repo.myproject.io&rdquo;,<br>Â Â Â Â Â Â Â Â &ldquo;arn:aws:s3:::repo.myproject.io/</em>&rdquo;<br>Â Â Â Â Â Â ]<br>Â Â Â Â }<br>Â Â ]<br>}</em></p><p>So <strong>repo.myproject.io</strong> is the name of the S3 bucket we created a few minutes ago.</p><p>Make sure you have an &ldquo;access key&rdquo; for this new user. It must look similar to this:</p><p><strong>key: AN4IANJTUN7ADI9XVKD5<br>secret: wuaRZQCCErX32avyxf5aTtfbmlFGE4iMFBOht5w3</strong></p><p>The key is 20 characters (all caps), and the secret is 40 characters.</p><p>Â </p><h2 id=configure-maven-settingsxml><strong>Configure maven</strong> settings.xml</h2><p>{#extend-settings-xml}</p><p>Add this configuration to your ~/.m2/settings.xml file:Â </p><p><em><br>Â <br>Â  Â <br>Â  Â  Â  repo.myproject.io<br>Â  Â  Â  AN4IANJTUN7ADI9XVKD5<br>Â  Â  Â  wuaRZQCCErX32avyxf5aTtfbmlFGE4iMFBOht5w3<br>Â  Â <br>Â  Â  [â€¦]</em></p><p>Â </p><p>Now I need to deploy one *.jar file to our privet repo. How can I do that?</p><p>I will use <strong>mvn</strong>**Â deploy file**. For my example, lets takeÂ **Java** **Wialon** **SDK** <a href=https://github.com/wialon/java_wialon_sdk>https://github.com/wialon/java_wialon_sdk</a>Â </p><ol><li><p>Download <a href=http://sdk.wialon.com/java_wialon_sdk.zip>wialon.jar</a>Â Place it for example to a directory /opt/.</p></li><li><p>Unpack and try to deploy to S3 bucket.</p></li></ol><p>Our command will look:</p><p><strong>mvn deploy:deploy-file -Dfile=wialon-sdk-1.3.57.jar -DgroupId=com.wialon -DartifactId=sdk-core -Dversion=1.3.57 -Dpackaging=jar -DrepositoryId=repo.awspoc.io.lib -Durl=s3://repo.myproject.io/lib</strong></p><p>I received several errors like:</p><p>Â </p><p><em>[ERROR] Failed to execute goal org.apache.maven.plugins:maven-deploy-plugin:2.7:deploy-file (default-cli) on project standalone-pom: Execution default-cli of goal org.apache.maven.plugins:maven-deploy-plugin:2.7:deploy-file failed: An API incompatibility was encountered while executing org.apache.maven.plugins:maven-deploy-plugin:2.7:deploy-file: java.lang.NoSuchFieldError: USE_DEFAULTS</em></p><p>Â </p><p>That&rsquo;s why I downloaded few libraries. Placed it to main Maven lib directory.</p><p><em>apache-httpcomponents-httpcore.jar<br>aws-java-sdk-1.11.110.jar<br>aws-java-sdk-1.11.110-javadoc.jar<br>aws-java-sdk-1.11.110-sources.jar<br>aws-maven-5.0.0.RELEASE.jar<br>commons-logging-1.2.jar<br>httpclient-4.5.3.jar<br>httpcore-4.4.6.jar<br>jackson-annotations-2.1.2.jar<br>jackson-annotations-2.8.7.jar<br>jackson-core-2.9.0.pr2.jar<br>jackson-databind-2.8.7.jar<br>joda-time-2.9.9.jar</em></p><p>Also I removed apache-httpcomponents-httpcore.jar which was an old version in the maven/lib. It causedÂ  a conflict with httpcore.jar</p><p>Run our command once more and Voila!</p><p><strong>mvn deploy:deploy-file -Dfile=wialon-sdk-1.3.57.jar -DgroupId=com.wialon -DartifactId=sdk-core -Dversion=1.3.57 -Dpackaging=jar -DrepositoryId=repo.awspoc.io.lib -Durl=s3://repo.myproject.io/lib</strong></p><p>Â </p><p><a href=http://noteits.net/wp-content/uploads/2017/04/deploy.png></a></p><p>Â Â Â Â Â </p><p>Also, you can delete all the deployed files with:</p><p><strong>aws</strong> <strong>s3 rm s3://repo.myproject.io/lib â€“recursive</strong></p><p><a href=http://noteits.net/wp-content/uploads/2017/04/delete.png></a></p><p>Stay tuned!</p><div class=nav-next-prev><div class=nav-prev><a href=https://vovando.dev/2017/01/13/git-clone-via-ssh-using-jenkins-on-windows/><i class="fas fa-chevron-left"></i></a></div><a class=nav-top href=#>top</i></a><div class=nav-next><a href=https://vovando.dev/2017/04/07/jenkins-xcode-error-select-a-development-team/><i class="fas fa-chevron-right"></i></a></div></div></div><footer><div class=footer-content><div class=contact-info><div class=footer-mail><i class="far fa-envelope"></i><a href=mailto:hello@vovando.dev>hello@vovando.dev</a></div><div class=footer-phone><i class="fas fa-phone"></i>7777</div></div><p class="copyright meta">Copyright Â© 2013â€“2020, all rights reserved.</p></div></footer></main></body><script src=https://vovando.dev/js/navbutton.js></script></html>