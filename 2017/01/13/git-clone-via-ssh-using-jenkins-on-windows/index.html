<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Clouds, Virtualization and something more..."><meta name=Author content="Volodymyr Vrublevskyy"><meta name=keywords content="IT Talks"><link rel=stylesheet href=https://vovando.dev/css/syntax.css><link rel=stylesheet href=https://vovando.dev/css/style.css><script src=https://kit.fontawesome.com/1b7478c139.js crossorigin=anonymous></script><title>IT Talks</title></head><body><aside id=sidenav><header><a href=https://vovando.dev/><img src=https://vovando.dev/avatar.png alt=avatar></a>
<a id=branding href=https://vovando.dev/>IT Talks</a></header><nav><a href=/><i class="fas fa-home fa-sm"></i><span>whoami</span></a>
<a href=/posts><i class="fas fa-keyboard fa-ms"></i><span>blog</span></a>
<a href=/tags><i class="fas fa-tags fa-ms"></i><span>tags</span></a>
<a href=https://github.com/vovandodev target=_blank><i class="fab fa-github fa-ms"></i><span>github</span></a>
<a href=/index.xml><i class="fas fa-rss fa-ms"></i><span>RSS</span></a>
<a href=/contact><i class="far fa-envelope"></i><span>contact</span></a></nav></aside><main id=main><a href=javascript:void(0) id=closebtn onclick=navToggle()><i class="fas fa-bars fa-lg"></i></a><div class=content><h1 id=title>Git Clone via SSH using Jenkins on Windows</h1><nav id=TableOfContents></nav><p>The cleanest way to use Jenkins on Windows is to use the <a href=https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins+as+a+Windows+service>Jenkins Installer</a> which installs Jenkins as a Windows Service.</p><p>That works fine, but of course the first challenge you face is cloning your Git repo over SSH (the default for the Jenkins Git plugin).</p><p>I’ll assume you have done the following:</p><ul><li><p>Installed <a href=https://code.google.com/p/msysgit/downloads/list>Git Client</a></p></li><li><p>Created <a href=https://help.github.com/articles/generating-ssh-keys#platform-windows>SSH Keys</a> and ensured that you can successfully clone a repo from your Git Bash (running as current user).</p><p>Note: In theory you should not use passwordless keys as anybody obtaining your key will have access to your account. However for Jenkins you cannot have a password as the Job would hang when attempting to clone. From Git Bash this problem is solved using <a href=https://help.github.com/articles/working-with-ssh-key-passphrases#platform-windows>ssh-agent</a> but this won’t work in Jenkins as we are using the Git plugin and not the shell.</p><p>Bottom line – for Jenkins use a passwordless key – you can mitigate the risk by having a dedicated Jenkins Git User and only allowing them pull access.</p></li><li><p>Set up the Git plugin in Jenkins via ‘Manage Jenkins’ and point it to the Git cmd file on the system, as in the screenshot below:</p></li></ul><p><img src=http://opensourcetester.co.uk/images/jenkins_git_plugin.png alt=jenkins_git_plugin></p><p>Now we get to the tricky part. When Jenkins runs as a Windows Service it does not run under a normal user account, it runs under the “Local System Account”. Hence even though you have Git Clone working as the current user it will fail in Jenkins.</p><p>To solve this problem we need to put our private ssh key in the correct location for the Local System Account.</p><p>First of all we need to find out where this user’s home directory is, since it will not exist under C:\Users…</p><ul><li>Download <a href=http://download.sysinternals.com/files/PSTools.zip>PSTools</a></li><li>Extract to a conventiant location and using a command prompt navigate to that location (or add to path if you prefer)</li><li>Start the PsExec tool by running:</li></ul><ul><li>Now we need to find out where this user’s home directory is:</li></ul><ul><li>For me this location was:</li></ul><ul><li>Now you can open Git Bash within this shell by running the following command:</li></ul><ul><li>You can copy your existing private key into the correct location for the Local System User, for me this was something like the following:</li></ul><ul><li>Finally you can test that you can successfully authenticate to Github as the Local System User:</li></ul><ul><li>If all is successful you should see the usual message:</li></ul><p>All that’s left to do now is test from Jenkins.</p><div class=nav-next-prev><div class=nav-prev><a href=https://vovando.dev/2016/12/16/how-to-install-maven-on-centos/><i class="fas fa-chevron-left"></i></a></div><a class=nav-top href=#>top</i></a><div class=nav-next><a href=https://vovando.dev/2017/04/04/private-maven-repository-in-amazon-s3/><i class="fas fa-chevron-right"></i></a></div></div></div><footer><div class=footer-content><div class=contact-info><div class=footer-mail><i class="far fa-envelope"></i><a href=mailto:hello@vovando.dev>hello@vovando.dev</a></div><div class=footer-phone><i class="fas fa-phone"></i>7777</div></div><p class="copyright meta">Copyright © 2013–2020, all rights reserved.</p></div></footer></main></body><script src=https://vovando.dev/js/navbutton.js></script></html>