<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Clouds, Virtualization and something more..."><meta name=Author content="Volodymyr Vrublevskyy"><meta name=keywords content="IT Talks"><link rel=stylesheet href=https://vovando.dev/css/syntax.css><link rel=stylesheet href=https://vovando.dev/css/style.css><script src=https://kit.fontawesome.com/1b7478c139.js crossorigin=anonymous></script><title>IT Talks</title></head><body><aside id=sidenav><header><a href=https://vovando.dev/><img src=https://vovando.dev/avatar.png alt=avatar></a>
<a id=branding href=https://vovando.dev/>IT Talks</a></header><nav><a href=/><i class="fas fa-home fa-sm"></i><span>whoami</span></a>
<a href=/posts><i class="fas fa-keyboard fa-ms"></i><span>blog</span></a>
<a href=/tags><i class="fas fa-tags fa-ms"></i><span>tags</span></a>
<a href=https://github.com/vovandodev target=_blank><i class="fab fa-github fa-ms"></i><span>github</span></a>
<a href=/index.xml><i class="fas fa-rss fa-ms"></i><span>RSS</span></a>
<a href=/contact><i class="far fa-envelope"></i><span>contact</span></a></nav></aside><main id=main><a href=javascript:void(0) id=closebtn onclick=navToggle()><i class="fas fa-bars fa-lg"></i></a><div class=content><h1 id=title>Adding Hyper-V VHDx in an Azure VM</h1><nav id=TableOfContents><ul><li><a href=#step-1-prep-the-vhd><strong>Step 1: Prep the VHD</strong></a></li><li><a href=#step-2-create-or-get-info-from-your-azure-storage-account><strong>Step 2: Create or get info from your Azure storage account</strong></a></li><li><a href=#step-3-connect-to-your-subscription-from-azure-powershell><strong>Step 3: Connect to your subscription from Azure PowerShell</strong></a></li><li><a href=#step-4-upload-the-vhd-file><strong>Step 4: Upload the .vhd file</strong></a></li></ul><ul><li><a href=#step-5-add-the-image-to-your-list-of-custom-images><strong>Step 5: Add the image to your list of custom images</strong></a></li></ul></nav><p>I have one task for today: to upload hyper-v vhdx image to azure and start vm. So let&rsquo;s try to realize this interesting thing.</p><p>Do the following steps:</p><p>(you can read detailed steps here)</p><h2 id=step-1-prep-the-vhd><strong>Step 1: Prep the VHD</strong></h2><h2 id=step-2-create-or-get-info-from-your-azure-storage-account><strong>Step 2: Create or get info from your Azure storage account</strong></h2><h2 id=step-3-connect-to-your-subscription-from-azure-powershell><strong>Step 3: Connect to your subscription from Azure PowerShell</strong></h2><p>Open the Azure PowerShell console.</p><p>Type:<br><strong>Add-AzureAccount</strong></p><p><a href=http://noteits.net/wp-content/uploads/2015/11/add-azure1.png></a></p><p>In the sign-in windows, type the user name and password of your work or school account.</p><p><a href=http://noteits.net/wp-content/uploads/2015/11/msazure.png></a></p><p>Azure authenticates and saves the credential information, and then closes the window.</p><h2 id=step-4-upload-the-vhd-file><strong>Step 4: Upload the .vhd file</strong></h2><p>From the Azure PowerShell window you used in the previous step, type a command similar to this:</p><p><strong>Add-AzureVhd -Destination &ldquo;//.vhd&rdquo; -LocalFilePath</strong></p><p>Where:</p><p><strong>BlobStorageURL</strong> is the URL for the storage account<br><strong>YourImagesFolder</strong> is the container within blob storage where you want to store your images<br><strong>VHDName</strong> is the name you want the Azure portal to display to identify the virtual hard disk<br><strong>PathToVHDFile</strong> is the full path and name of the .vhd file</p><h1 id=span-stylecolorff0000stronghere-i-received-following-errorstrongspan>Here I received following error:</h1><p><a href=http://noteits.net/wp-content/uploads/2015/11/erro-az.png></a></p><p>So be aware of:</p><p>Virtual Machines in Azure must be .vhd files.  They cannot be .vhdx or other platforms. There are easy ways to convert to .vhd though.</p><p><strong>Convert-VHD –Path “C:\VM\Virtual Hard Disks\MyVM.vhdx” –DestinationPath “C:\VM\Virtual Hard Disks\MyNewVM.vhd”</strong></p><p>You should also be aware that there are limits to the size of the VM that you can attach. I went through the process I’m about to describe to you only to find out that at my .vhd was too large.  The maximum supported OS disk size is 128 GB.  Any larger and you will see an error like the screen shot below. Notice this is just the OS disk size so that tells you that other disks that are larger can be attached later. </p><p><a href=http://noteits.net/wp-content/uploads/2015/11/upload-az.png></a></p><p> </p><h2 id=step-5-add-the-image-to-your-list-of-custom-images><strong>Step 5: Add the image to your list of custom images</strong></h2><ol><li><p>From the Azure portal, under <strong>All Items</strong>, click <strong>Virtual Machines</strong>.</p></li><li><p>Under Virtual Machines, click <strong>Images</strong>.</p></li><li><p>Click <strong>Create an Image</strong>.</p></li></ol><p><a href=http://noteits.net/wp-content/uploads/2015/11/create-im.png></a></p><p>After you complete the previous steps, the new image is listed when you choose the <strong>Images</strong> tab.</p><p>This new image is now available under <strong>My Images</strong> when you create a virtual machine.</p><p><a href=http://noteits.net/wp-content/uploads/2015/11/imagesall.png></a></p><p><a href=http://noteits.net/wp-content/uploads/2015/11/access.png></a></p><div class=nav-next-prev><div class=nav-prev><a href=https://vovando.dev/2015/11/12/packer-with-azure/><i class="fas fa-chevron-left"></i></a></div><a class=nav-top href=#>top</i></a><div class=nav-next><a href=https://vovando.dev/2016/02/01/restart-unicorn-with-capistrano/><i class="fas fa-chevron-right"></i></a></div></div></div><footer><div class=footer-content><div class=contact-info><div class=footer-mail><i class="far fa-envelope"></i><a href=mailto:hello@vovando.dev>hello@vovando.dev</a></div><div class=footer-phone><i class="fas fa-phone"></i>7777</div></div><p class="copyright meta">Copyright © 2013–2020, all rights reserved.</p></div></footer></main></body><script src=https://vovando.dev/js/navbutton.js></script></html>