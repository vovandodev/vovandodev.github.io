<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Clouds, Virtualization and something more..."><meta name=Author content="Volodymyr Vrublevskyy"><meta name=keywords content="IT Talks"><link rel=stylesheet href=https://vovando.dev/css/syntax.css><link rel=stylesheet href=https://vovando.dev/css/style.css><script src=https://kit.fontawesome.com/1b7478c139.js crossorigin=anonymous></script><title>IT Talks</title></head><body><aside id=sidenav><header><a href=https://vovando.dev/><img src=https://vovando.dev/avatar.png alt=avatar></a>
<a id=branding href=https://vovando.dev/>IT Talks</a></header><nav><a href=/><i class="fas fa-home fa-sm"></i><span>whoami</span></a>
<a href=/posts><i class="fas fa-keyboard fa-ms"></i><span>blog</span></a>
<a href=/tags><i class="fas fa-tags fa-ms"></i><span>tags</span></a>
<a href=https://github.com/vovandodev target=_blank><i class="fab fa-github fa-ms"></i><span>github</span></a>
<a href=/index.xml><i class="fas fa-rss fa-ms"></i><span>RSS</span></a>
<a href=/contact><i class="far fa-envelope"></i><span>contact</span></a></nav></aside><main id=main><a href=javascript:void(0) id=closebtn onclick=navToggle()><i class="fas fa-bars fa-lg"></i></a><div class=content><h1 id=title>“Cannot run upgrade script on host” during upgrade from esxi 5.5 to 6.0</h1><nav id=TableOfContents></nav><p>The host upgrade from ESXi 5.5 to ESXi 6.0 failed with the following error: „Cannot execute upgrade script on host“.</p><p></p><p> </p><p>I found two possible issues – the second one worked for me:</p><p><strong>Issue 1: /bootbank/state.xxxxxxxx directory not empty</strong></p><p>Take a look at KB 2007163 „Upgrading a VMware ESXi host fails with the error: Cannot run upgrade script on host“</p><p><strong>Issue 2: troubles with the FDM agent (former HA agent) from the host</strong></p><p>In my case issue 2 was the problem – performing the steps descriped below did the trick for me.</p><p>I found the following message in the /var/log/vua.log:</p><blockquote><p>2015-08-17T12:29:16.999Z error vua[FFF940D0] [Originator@6876 sub=Default] Alert:WARNING: This application is not using QuickExit(). The exit code will be set to 0.@ bora/vim/lib/vmacore/main/service.cpp:162<br>–> Backtrace:<br>–><br>–> [backtrace begin] product: VMware vSphere Update Manager Agent, version: 6.0.0, build: build-2621470, tag: vua<br>–> backtrace[00] libvmacore.so[0x0033D8E3]: Vmacore::System::Stacktrace::CaptureFullWork(unsigned int)</p><p> </p><p><strong>Resolution:</strong></p><ul><li>disable HA for the cluster</li><li>remove the ESXi host from the cluster</li><li>connect  via SSH to the ESXi host and run the following commands to uninstall the FDM agent:</li></ul><p>(as also descriped in KB 1003714 „<a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2007163">Verifying and reinstalling the correct version of the VMware vCenter Server agents</a>”)</p><p>cp /opt/vmware/uninstallers/VMware-fdm-uninstall.sh /tmp<br>chmod +x /tmp/VMware-fdm-uninstall.sh<br>/tmp/VMware-fdm-uninstall.sh</p><p></p></blockquote><ul><li>reboot the host</li></ul><p>Now you can re-add the host to the cluster and perform the upgrade to ESXi 5.5. Do not forget to enable HA.</p><div class=nav-next-prev><div class=nav-prev><a href=https://vovando.dev/2015/08/17/the-data-service-timed-out-because-a-back-end-task-took-more-than-120/><i class="fas fa-chevron-left"></i></a></div><a class=nav-top href=#>top</i></a><div class=nav-next><a href=https://vovando.dev/2015/08/23/installing-chef-on-centos-6/><i class="fas fa-chevron-right"></i></a></div></div></div><footer><div class=footer-content><div class=contact-info><div class=footer-mail><i class="far fa-envelope"></i><a href=mailto:hello@vovando.dev>hello@vovando.dev</a></div><div class=footer-phone><i class="fas fa-phone"></i>7777</div></div><p class="copyright meta">Copyright © 2013–2020, all rights reserved.</p></div></footer></main></body><script src=https://vovando.dev/js/navbutton.js></script></html>