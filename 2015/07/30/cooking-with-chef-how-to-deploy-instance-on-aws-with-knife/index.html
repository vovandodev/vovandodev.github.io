<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Clouds, Virtualization and something more..."><meta name=Author content="Volodymyr Vrublevskyy"><meta name=keywords content="IT Talks"><link rel=stylesheet href=https://vovando.dev/css/syntax.css><link rel=stylesheet href=https://vovando.dev/css/style.css><script src=https://kit.fontawesome.com/1b7478c139.js crossorigin=anonymous></script><title>IT Talks</title></head><body><aside id=sidenav><header><a href=https://vovando.dev/><img src=https://vovando.dev/avatar.png alt=avatar></a>
<a id=branding href=https://vovando.dev/>IT Talks</a></header><nav><a href=/><i class="fas fa-home fa-sm"></i><span>whoami</span></a>
<a href=/posts><i class="fas fa-keyboard fa-ms"></i><span>blog</span></a>
<a href=/tags><i class="fas fa-tags fa-ms"></i><span>tags</span></a>
<a href=https://github.com/vovandodev target=_blank><i class="fab fa-github fa-ms"></i><span>github</span></a>
<a href=/index.xml><i class="fas fa-rss fa-ms"></i><span>RSS</span></a>
<a href=/contact><i class="far fa-envelope"></i><span>contact</span></a></nav></aside><main id=main><a href=javascript:void(0) id=closebtn onclick=navToggle()><i class="fas fa-bars fa-lg"></i></a><div class=content><h1 id=title>Cooking with Chef: How to deploy instance on AWS with knife</h1><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav><p>Today I want to try provisioning and configuring Amazon AWS instances with Chef. To do that I have:</p><ul><li>Free tier account on AWS</li><li>Open Source Chef Server 12</li><li>Ubuntu Workstation with knife</li></ul><p> </p><ol><li>First of all we need to install <strong>knife ec2</strong> on Ubuntu Workstation:</li></ol><p><strong>gem install knife-ec2</strong></p><p>Afert that I configured <strong>knife.rb</strong> at /home/vovando/chef-repo/.chef</p><p>————————————————————————————</p><p>knife[:aws_access_key_id] = &ldquo;Abababababbb&rdquo;<br>knife[:aws_secret_access_key] = &ldquo;Blablablaaaaaaaaa&rdquo;<br># AWS Region<br>knife[:region] = &ldquo;us-west-2&rdquo;<br>————————————————————————————</p><p>You can find or create <strong>aws_access_key_id</strong>  and <strong>aws_secret_access_key</strong> here:</p><p> </p><p></p><p></p><p></p><p> </p><p>Let&rsquo;s test our connection to AWS:</p><p><strong>sudo knife ec2 server list</strong></p><p></p><p> </p><p><strong>Deleting the server</strong></p><p><strong>sudo knife ec2 server delete i-d8892c11</strong></p><p></p><p>Terminated.</p><p></p><p> </p><h5 id=font-size5-stylefont-weight-boldcreating-a-serverfont>Creating a server</h5><p>You’ll need:</p><ul><li><p>the ID of the subnet you intend to deploy into</p></li><li><p>the AMI you wish to use</p></li><li><p>the security group IDs for the new instance
(one of these must contain a rule which allows inbound SSH access from the SSH gateway)</p></li><li><p>ssh key</p></li></ul><p> </p><p>If you have all that, you can use the following command:</p><p>$ sudo knife ec2 server create \<br>–flavor t2.micro  \<br>–image ami-e7527ed7 \<br>–ebs-size 8 \<br>–security-group-ids sg-6e0adc0a \<br>–subnet subnet-575ccd20 \<br>–ssh-key noteits \<br>–server-connect-attribute public_ip_address \<br>–ssh-user ec2-user \<br>–ssh-port 22 \<br>–identity-file /home/vovando/noteits.pem \<br>–node-name &ldquo;noteits.net&rdquo; \<br>–tags Name=&ldquo;noteits.net&rdquo;,Environment=&ldquo;Production&rdquo; \<br>–run-list &ldquo;role[web_server]&rdquo; \<br>–environment prod</p><p> </p><p></p><p> </p><p>In AWS console:</p><p></p><p> </p><h5 id=font-size5-stylefont-weight-boldbootstrapping-a-serverfont>Bootstrapping a server</h5><p>If you already have a server in the AWS, you can also bootstrap it using the SSH:</p><p>$ sudo knife bootstrap 52.27.26.166 \<br>  –ssh-user ec2-user \<br>  –sudo \<br>  –identity-file /home/vovando/noteits.pem \<br>  –environment production \<br>  –node-name noteits.net \<br>  –run-list &lsquo;role[web_server]&rsquo;<br>[sudo] password for vovando:</p><p>Creating new client for noteits.net<br>Creating new node for noteits.net<br>Connecting to 52.27.26.166<br>52.27.26.166 —–> Existing Chef installation detected<br>52.27.26.166 Starting first Chef Client run…<br>52.27.26.166 Starting Chef Client, version 12.4.1</p><p><em>And that’s all there is to it!</em></p><div class=nav-next-prev><div class=nav-prev><a href=https://vovando.dev/2015/07/28/free-ssl-certificate-for-3-years-and-up-to-100-domains/><i class="fas fa-chevron-left"></i></a></div><a class=nav-top href=#>top</i></a><div class=nav-next><a href=https://vovando.dev/2015/07/31/how-to-monitor-sql-queries-with-zabbix/><i class="fas fa-chevron-right"></i></a></div></div></div><footer><div class=footer-content><div class=contact-info><div class=footer-mail><i class="far fa-envelope"></i><a href=mailto:hello@vovando.dev>hello@vovando.dev</a></div><div class=footer-phone><i class="fas fa-phone"></i>7777</div></div><p class="copyright meta">Copyright © 2013–2020, all rights reserved.</p></div></footer></main></body><script src=https://vovando.dev/js/navbutton.js></script></html>